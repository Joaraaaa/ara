<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="org.ara.mapper.ReservationMapper">
	<insert id="insert">
	insert into res_set(bno, date, r_time, people, rno)
	values(#{bno}, #{date}, #{r_time}, #{people}, #{rno});
	</insert>
	
	<select id="select" resultType="org.ara.model.ResSetVO">	
	select *
	from res_set
	where bno=#{bno}
	and date=#{date}
	<!-- 
	select * 
	from r_setting rs
	join reservation r
	on rs.rno = r.rno
	where bno = #{bno};
	 -->
	</select>
	
	<delete id="delete">
	delete from r_setting where 
	<choose>
		<when test="bno==0">
		rno=#{rno};
		</when>
		<otherwise>
		bno=#{bno};
		</otherwise>
		</choose>
	</delete>
	
	<update id="update">
	update reservation 
	set r_name=#{r_name},r_phone=#{r_phone},
	<choose>
	<when test="email==''">
	email="비회원"
	</when>
	<otherwise>
	email=#{email}
	</otherwise>
	</choose>
	where rno=#{rno};
	</update>
	
	<insert id="rnoInsert">
	insert into reservation(rno,email,r_name,r_phone)
	values(#{rno},"예약가능","예약가능","예약가능")
	</insert>
	
	<update id="status">
	update r_setting
	set r_status=#{r_status}
	where rno=#{rno};
	</update>
	
	<resultMap type="org.ara.model.ReservationVO" id="ReservationVO">
		<result column="rno" property="rno"/>
		<result column="date" property="date"/>
		<result column="email" property="email"/>
		<result column="r_name" property="r_name"/>
		<result column="r_phone" property="r_phone"/>
		<collection property="svo" resultMap="StoreVO"/>
	</resultMap>
	<resultMap type="org.ara.model.StoreVO" id="StoreVO">
		<result column="store" property="store"/>
		<result column="bno" property="bno"/>
	</resultMap>
	<select id="r_select" resultMap="ReservationVO">
	select rv.rno, date, email, r_name, r_phone, store, bno
	from reservation rv
	join(
	select rno, date, store, r.bno
	from r_setting r
	join store s
	on r.bno=s.bno
	)sr
	on rv.rno=sr.rno
	where r_name=#{r_name}
	and r_phone=#{r_phone};
	</select>
	<select id="list" resultType="org.ara.model.RUserInfoVO">
	select * 
	from r_user_info
	where rno=#{rno};
	</select>
	<select id="rpselect" resultType="int">
	select r_people
	from r_user_info
	where rno=#{rno}
	and cno=#{cno};
	</select>
	<select id="pselect" resultType="int">
	select people
	from res_set
	where rno=#{rno};
	</select>
</mapper>